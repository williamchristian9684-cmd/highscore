<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Chivalry Legion High Scores</title>
<style>
html, body { margin:0; padding:0; height:100%; background:#000; color:#fff; font-family: Arial,sans-serif; }
body { display:flex; flex-direction:column; min-height:100vh; }
#mainContent { flex:1; display:flex; flex-direction:column; max-width:1600px; margin:0 auto; padding:20px; }
.tabs { display:flex; justify-content:center; gap:5px; margin-bottom:15px; }
.tab-btn { padding:8px 15px; background:#111; border:none; color:#fff; cursor:pointer; border-radius:5px; }
.tab-btn.active { background:orange; color:#000; font-weight:bold; }
.container { display:flex; gap:15px; flex:1; }
.column { background:#111; border-radius:8px; padding:15px; border:1px solid #444; overflow-x:auto; overflow-y:auto; }
.column h2 { text-align:center; color:orange; margin-bottom:10px; }
.stats-table { width:100%; border-collapse:collapse; }
.stats-table th, .stats-table td { border:1px solid #444; padding:8px; text-align:center; }
.stats-table th { background:#222; font-weight:bold; color:#fff; cursor:pointer; }
.stats-table td { background:#111; color:#eee; }
.stats-table tr:nth-child(even) td { background:#1a1a1a; }
.stats-table tbody tr:hover { background:#333 !important; }
.player-name { font-weight:bold; cursor:pointer; }
.tooltip { display:none; position:fixed; background:#222; padding:10px; border-radius:6px; box-shadow:0 0 10px rgba(255,255,255,0.3); z-index:999; min-width:220px; max-height:400px; overflow-y:auto; color:#fff; font-size:12px; white-space:nowrap; }
.legend-box { width:180px; flex-shrink:0; }
.legend-box div { font-weight:bold; margin:5px 0; cursor:pointer; }
.loading { text-align:center; font-style:italic; color:#999; }
.error { color:#ff4d4d; font-weight:bold; }
.refresh-btn { display:block; margin:10px auto 20px auto; padding:5px 10px; background:orange; color:#000; font-weight:bold; border:none; border-radius:5px; cursor:pointer; }
#lastUpdated { text-align:center; font-size:12px; color:#aaa; margin-top:10px; }
#searchBar { display:block; margin:0 auto 15px auto; padding:5px 10px; width:300px; border-radius:5px; border:none; }

#loadingOverlay {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.9);
  display:flex; justify-content:center; align-items:center;
  z-index:9999;
  flex-direction:column;
  color:#fff;
  font-size:20px;
}
#spinner {
  border:8px solid #111;
  border-top:8px solid orange;
  border-radius:50%;
  width:60px;
  height:60px;
  animation: spin 1s linear infinite;
  margin-bottom:10px;
}
@keyframes spin { 0% { transform:rotate(0deg); } 100% { transform:rotate(360deg); } }
</style>
</head>
<body>

<div id="loadingOverlay"><div id="spinner"></div>Loading players...</div>

<img src="https://i.imgur.com/OU2IAhu.png" alt="Clan Logo" id="clanLogo" style="display:block;margin:0 auto 10px auto; max-width:150px; cursor:pointer;">

<input type="text" id="searchBar" placeholder="Search players...">

<div id="mainContent">
  <div class="tabs">
    <button class="tab-btn active" data-tab="mains">Mains</button>
    <button class="tab-btn" data-tab="meds">Meds</button>
    <button class="tab-btn" data-tab="ironman">Ironman</button>
    <button class="tab-btn" data-tab="hcim">HCIM</button>
    <button class="tab-btn" data-tab="uim">UIM</button>
  </div>

  <div class="container">
    <!-- Left column: Ranks Legend -->
    <div class="column legend-box" id="ranksLegend">
      <h2>Ranks Legend</h2>
      <div data-rank="#FF2900" style="color:#FF2900;">Leader</div>
      <div data-rank="#FF00E1" style="color:#FF00E1;">Council</div>
      <div data-rank="#00FF91" style="color:#00FF91;">Captain</div>
      <div data-rank="#FFF12E" style="color:#FFF12E;">Legend</div>
      <div data-rank="#ADA653" style="color:#ADA653;">Elder</div>
      <div data-rank="#A30090" style="color:#A30090;">Old School</div>
      <div data-rank="#0E00A3" style="color:#0E00A3;">Senior</div>
      <div data-rank="#003CFF" style="color:#003CFF;">Member</div>
      <div data-rank="#00BFFF" style="color:#00BFFF;">Trial</div>
      <div data-rank="#B6B6B6" style="color:#B6B6B6;">Retired</div>
      <button class="refresh-btn" id="unfilterRankBtn">Unfilter Rank</button>
    </div>

    <!-- Middle column: Player table -->
    <div class="column" style="flex:1;">
      <table class="stats-table" id="statsTable">
        <thead>
          <tr>
            <th data-sort="name">Name</th>
            <th data-sort="nickname">Nickname</th>
            <th data-sort="attack">Attack</th>
            <th data-sort="strength">Strength</th>
            <th data-sort="defence">Defence</th>
            <th data-sort="ranged">Ranged</th>
            <th data-sort="magic">Magic</th>
            <th data-sort="prayer">Prayer</th>
            <th data-sort="combat">Combat</th>
            <th data-sort="total">Total</th>
          </tr>
        </thead>
        <tbody id="statsTableBody">
          <tr><td colspan="10" class="loading">Loading...</td></tr>
        </tbody>
      </table>
    </div>

    <!-- Right column: Average stats -->
    <div class="column" style="width:250px;">
      <h2>Average Stats</h2>
      <div id="averageContent">Loading...</div>
      <button class="refresh-btn" id="unfilterSkillBtn">Unfilter Skill</button>
    </div>
  </div>

  <div id="lastUpdated"></div>
</div>

<div class="tooltip" id="tooltip"></div>

<script>
// (JavaScript is the same as previously provided)
// At the end of loadTab(), hide the overlay:
async function loadTab(tab){
  currentTab=tab;
  document.getElementById('loadingOverlay').style.display='flex';
  playerStats={};
  document.getElementById('statsTableBody').innerHTML=`<tr><td colspan="10" class="loading">Loading...</td></tr>`;
  document.getElementById('averageContent').innerHTML='Loading...';
  const players = TABS[tab];
  await Promise.all(players.map(p=>fetchPlayer(p.name)));
  renderTable();
  renderAverageBox();
  document.getElementById('lastUpdated').textContent='Last updated: '+new Date().toLocaleString();
  document.getElementById('loadingOverlay').style.display='none';
}
</script>

</body>
</html>
